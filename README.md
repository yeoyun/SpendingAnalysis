# SpendingAnalysis

개인 소비 내역을 업로드하면, 자동으로 정제·분석·시각화하고, AI가 소비 패턴 리포트까지 생성해주는 Streamlit 기반 대시보드입니다.

---

## 프로젝트 폴더 구조

```plaintext
SpendingAnalysis/
├── app/
│   ├── streamlit_app.py         # 메인 Streamlit 앱 (대시보드 전체 흐름)
│   ├── charts.py                # 주요 시각화 함수 모음
│   └── sidebar.py               # 사이드바 UI 및 컨트롤
├── expense_preprocess/
│   ├── preprocess.py            # 데이터 전처리(정제) 핵심 로직
│   └── data_manager/
│       └── page.py              # 데이터 업로드/정제/활성화 UI
├── ai_report/
│   ├── features.py              # 리포트용 통계/특징 생성
│   ├── prompt.py                # AI 프롬프트 및 출력 스키마
│   ├── llm.py                   # LLM 호출 래퍼
│   ├── export.py                # Markdown 내보내기
│   └── ui/
│       ├── generators.py        # 리포트 생성 버튼 핸들러
│       ├── sidebar.py           # 리포트 관련 사이드바 컨트롤
│       ├── renderers.py         # 리포트 렌더링
│       └── short_report_ui.py   # 단기 리포트 렌더링
├── persona/
│   ├── infer_ai.py              # 소비 페르소나 추론
│   └── legacy/
│       └── card_renderer.py     # 페르소나 카드 렌더링
├── data/
│   ├── sample_data.csv          # 샘플 데이터
│   └── active/                  # 활성 데이터 저장
├── ai_cache/                    # AI 응답 캐시
├── requirements.txt             # 의존성 목록
├── .env                         # API 키 등 환경변수 (Git 제외)
├── .gitignore                   # Git 제외 파일
└── README.md                    # 프로젝트 설명
```

### 폴더/파일 역할 요약

- **app/**: Streamlit 앱 엔트리, 시각화, 사이드바 등 전체 UI 흐름 담당
- **expense_preprocess/**: 데이터 업로드, 정제, 전처리 담당
- **ai_report/**: AI 리포트 생성, 프롬프트, LLM 호출, 내보내기 등
- **persona/**: 소비 페르소나 추론 및 카드 렌더링
- **data/**: 샘플 및 활성 데이터 저장
- **ai_cache/**: AI 응답 캐시(중복 호출 방지)
- **requirements.txt**: 필요한 파이썬 패키지 목록
- **.env**: API 키 등 환경변수 (반드시 Git에 올리지 마세요)
- **README.md**: 프로젝트 설명

---

## 실행 방법

1. 의존성 설치  
   ```sh
   pip install -r requirements.txt
   ```
2. 환경변수 설정  
   `.env` 파일에 LLM API 키 등 입력 (예: `GEMINI_API_KEY=...`)
3. 앱 실행  
   ```sh
   streamlit run app/streamlit_app.py
   ```

---

## 1. 대시보드 전체 구조  
(기준: `app/streamlit_app.py`)

- **사이드바**  
  - 데이터 관리(업로드/정제/활성화)
  - AI 리포트 생성/다운로드/초기화
  - 분석 기간, 야간 기준 등 파라미터 조정

- **메인 페이지**  
  - 데이터 업로드/정제 안내
  - 소비 페르소나 카드(자동 추론)
  - 주요 KPI(총 지출, 평균, 고정비 등)
  - 다양한 소비 패턴 그래프
  - AI 리포트(전체/단기) 결과 표시

---

## 2. 전처리 로직  
(기준: `expense_preprocess/preprocess.py`)

- **업로드**: CSV/엑셀 등 다양한 포맷 지원
- **정제**:
  - 날짜/금액/카테고리/메모 등 컬럼 표준화
  - 금액 부호(지출/수입) 정리, 결제수단/간편결제 태깅
  - 시간대, 요일, 주말/평일 등 파생 컬럼 생성
  - 결측치/이상치 처리
- **활성화**: 정제된 데이터셋을 분석용으로 지정

---

## 3. 최종 정제된 컬럼 명세

| 컬럼명             | 설명                                 |
|--------------------|--------------------------------------|
| date               | 거래 일자 (YYYY-MM-DD)               |
| amount             | 거래 금액 (지출은 음수, 수입은 양수) |
| is_expense         | 지출 여부 (True/False)               |
| category           | 거래 카테고리                        |
| description        | 거래 상세 설명/메모                   |
| hour               | 거래 시간 (0~23)                      |
| weekday            | 요일 (0=월~6=일)                      |
| is_weekend         | 주말 여부 (True/False)                |
| payment_method     | 결제수단 (카드/현금/간편결제 등)      |
| tag                | 자동 태깅(고정비/변동비/이체 등)      |
| ...                | 기타 파생 컬럼(필요시 추가)           |

※ 실제 컬럼은 업로드 데이터와 전처리 옵션에 따라 일부 달라질 수 있습니다.

---

## 4. 각 그래프의 역할 (소비 패턴에서 볼 수 있는 것)

- **기간 한 줄 메시지**  
  - 분석 기간의 소비 특징을 요약(증감, 특이점 등)

- **월별 누적/일별 누적 비교**  
  - 월별 소비 추이, 월내 일별 누적 소비 패턴 비교  
  - 이번 달 vs 전월/평균 등 비교로 소비 습관 변화 파악

- **시간대별 소비 분포**  
  - 하루 중 언제 소비가 집중되는지(야간/주간/평일/주말 등)  
  - 야간 소비 비중, 특정 시간대 과소비 탐지

- **피크 패턴 카드**  
  - 특정 카테고리/일자에서의 소비 급증, 반복 패턴 등  
  - 고액 거래, 반복 지출 등 주요 이슈 탐지

- **KPI 카드**  
  - 총 지출, 평균 지출, 고정비, 상위 카테고리, 초과 지출 항목 등  
  - 소비 구조의 전반적 건강성 진단

---

## 5. AI 리포트 페이지  
(기준: `ai_report/prompt.py` 및 리포트 UI)

- **역할**  
  - 전체 소비 패턴을 AI가 요약(3줄 요약, 문제점, 개선방안)
  - 주요 지표(수입/지출/비율/고정비/카테고리 등) 해석
  - 소비 페르소나(성향) 자동 추론 및 설명
  - 위험/경고(과소비, 특정 카테고리 집중 등) 자동 탐지
  - 맞춤형 액션 플랜(체크리스트) 제안(평일/주말 구분)
  - 단기(최근 30일) 소비 변화 분석 및 단기 리포트 제공
  - Markdown 내보내기로 리포트 저장 가능

- **확인할 수 있는 것**  
  - 내 소비의 전반적 건강성, 위험 신호, 개선 포인트
  - 내 소비 성향(페르소나)과 그 근거
  - 단기/전체 소비 변화, 주요 이슈, 실천 방안

---

## 예시 실행 화면

https://github.com/user-attachments/assets/01503c09-12e3-4cb6-afc3-e87cf953c10f


---

## 참고/주의

- AI 리포트는 참고용이며, 투자/세무 등 고위험 의사결정에는 사용하지 마세요.
- LLM 호출에는 API 키와 네트워크가 필요합니다.
- 데이터는 반드시 개인정보를 제거 후 업로드하세요.

---

## 문의/기여

- @yeoyun
